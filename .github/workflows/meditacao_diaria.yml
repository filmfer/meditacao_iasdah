name: Publicar Meditação Diária no Telegram

on:
  schedule:
    # Executa às 7:30 UTC todos os dias.
    # A hora aqui é UTC. Como os Açores em agosto estão em UTC+0, 7:30 é o correto.
    # Ajuste se a sua zona horária for diferente no inverno.
    - cron: '34 7 * * *'
  # Permite também executar manualmente a partir do separador Actions no GitHub
  workflow_dispatch:

jobs:
  build-and-send:
    runs-on: ubuntu-latest
    steps:
      - name: Check out a cópia do repositório
        uses: actions/checkout@v3

      - name: Configurar o Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # Pode usar a versão que preferir

      - name: Instalar o locale de Português Europeu (pt_PT)
        run: |
          sudo apt-get update
          sudo apt-get install -y language-pack-pt
          sudo locale-gen pt_PT.UTF-8
          sudo update-locale LANG=pt_PT.UTF-8

      - name: Instalar dependências
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 urllib3

      - name: Executar o script de publicação
        env:
          # Usa os secrets que configurou no repositório
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          EMAIL_ADDRESS: ${{ secrets.EMAIL_ADDRESS }}
          GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
          WHATSAPP_ACCESS_TOKEN: ${{ secrets.WHATSAPP_ACCESS_TOKEN }}
          WHATSAPP_PHONE_NUMBER_ID: ${{ secrets.WHATSAPP_PHONE_NUMBER_ID }}
          WHATSAPP_GROUP_ID: ${{ secrets.WHATSAPP_GROUP_ID }}

        run: python meditacao_iasdah_ok2.py
